"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.outputFile = void 0;
/**
 * Stable outputfile implementation.
 * If the file's content haven't changed, don't write anything to the disk.
 *
 * This is necessary to avoid webpack to enter in an infinite loop
 */
const crypto_1 = require("crypto");
const fs_extra_1 = require("fs-extra");
const filesMap = new Map();
function hash(s) {
    return crypto_1.createHash('md5').update(s, 'utf8').digest().toString('hex');
}
exports.outputFile = (file, data) => {
    const newHash = hash(JSON.stringify(data));
    const oldHash = filesMap.get(file);
    // The files content are equal, don't do anything
    if (oldHash === newHash) {
        return;
    }
    filesMap.set(file, newHash);
    return fs_extra_1.outputFile(file, data);
};
