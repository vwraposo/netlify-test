"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.usePixelSendEvent = exports.sendPixelEvent = void 0;
const pixel_1 = require("./pixel");
const useIdleEffect_1 = require("../useIdleEffect");
exports.sendPixelEvent = (event) => {
    try {
        window.postMessage(pixel_1.wrap(event), window.origin);
    }
    catch (e) {
        // IE and Edge have a bug on postMessage inside promises.
        // Ignoring for now, will try to find a workaround that
        // makes postMessage work on those browsers.
        // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/14719328/
        console.error(e);
    }
};
exports.usePixelSendEvent = (event, id = '') => {
    useIdleEffect_1.useIdleEffect(() => {
        const obj = typeof event === 'function' ? event() : event;
        if (Array.isArray(obj)) {
            obj.forEach(exports.sendPixelEvent);
        }
        else {
            exports.sendPixelEvent(obj);
        }
    }, [id]);
};
